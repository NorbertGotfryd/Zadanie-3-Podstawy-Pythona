#importy wymaganych bibliotek
import requests
import csv

# wprowadzenie danych faktur
invoice_value = input("Podaj wartość faktury:\n")
invoice_currency = input("Wybierz walutę z podanych:\nEUR\nUSD\nCZK\n")
invoice_date = input("Podaj datę wystawienia (RRRR-MM-DD\n)")
invoice = [invoice_value, invoice_currency, invoice_date]

# wprowadzenie danych płatności
payment_value = input("Podaj wartość płatności:\n")
payment_currency = input("Wybierz walutę z podanych:\nEUR\nUSD\nCZK\n")
payment_date = input("Podaj datę płatności (RRRR-MM-DD\n)")
payment = [payment_value, payment_currency, payment_date]

# zapis faktur do pliku txt
with open('invoices.txt', 'a', encoding='UTF8') as invoices_file:
    writer = csv.writer(invoices_file)
    writer.writerow(invoice)
    invoices_file.close()

# zapis metody płatności do pliku txt
with open('payments.txt', 'a', encoding='UTF8') as payment_file:
    writer = csv.writer(payment_file)
    writer.writerow(payment)
    payment_file.close()

currency = invoice_currency
quantity = int(invoice_value)

# komunikacja z API
communication = requests.get(f'http://api.nbp.pl/api/exchangerates/rates/c/{currency}/{invoice_date}/?format=json')
response = communication.json()
result = response['rates'][0]['bid'] * quantity

# zapis wyniku operacji do pliku txt
with open('payment_results.txt', 'a', encoding='UTF8') as results_file:
            writer = csv.writer(results_file)
            results_file.write(str(result))
            results_file.close()

# wyświetlenie w terminalu informacji o statusie faktury
if invoice_value == payment_value:
    print(f"wartośc faktury wynosi {invoice_value}, czyli {result} w {invoice_currency} - stan na dzień {invoice_date} - Faktura została opłacona w całośći")
elif invoice_value < payment_value:
    print(f"wartośc faktury wynosi {invoice_value}, czyli {result} w {invoice_currency} - stan na dzień {invoice_date} - zapłacone zostało {payment_value} z {invoice_value} wymaganych - nastąpiła nadpłata (wymagany zwrot w kwocie", int(payment_value) - int(invoice_value),")")
else:
    print(f"wartośc faktury wynosi {invoice_value}, czyli {result} w {invoice_currency} - stan na dzień {invoice_date} - zapłacone zostało {payment_value} z {invoice_value} wymaganych - nastąpiła niedopłata (wymagana dopłata w kwocie", int(invoice_value) - int(invoice_value),")")